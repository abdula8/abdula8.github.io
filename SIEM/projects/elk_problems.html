<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problems I Faced in Installing ELK Stack</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f4f4f4;
            padding: 10px;
        }
        h1, h2 {
            color: #333;
        }
        pre {
            background-color: #eee;
            padding: 10px;
            border: 1px solid #ccc;
            overflow-x: auto;
        }
        code {
            background-color: #f9f9f9;
            padding: 2px 4px;
            border-radius: 4px;
        }
        footer {
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>Problems I Faced in Installing ELK Stack on CentOS 9</h1>

    <h2>General Configurations</h2>
    <p>We use <code>/etc/profile</code> for permanent storage of environmental variables working after a restart.</p>
    <p>Selinux file config: <code>/etc/sysconfig/selinux</code></p>

    <h2>Firewall Commands</h2>
    <pre>
sudo firewall-cmd --permanent --add-port=514/udp
sudo firewall-cmd --permanent --add-port=514/tcp
sudo firewall-cmd --reload
    </pre>

    <h2>ElasticSearch</h2>
    <p>The problem that lasted for about 2 days was related to certificates. After installing Elasticsearch on CentOS 9, I got this error when visiting <a href="https://localhost:9200">https://localhost:9200</a>:</p>
    <pre>{
    "error" : {
        "root_cause" : [ { "type" : "status_exception", "reason" : "Cluster state has not been recovered yet, cannot write to the [null] index" } ],
        "type" : "authentication_processing_error",
        "reason" : "failed to promote the auto-configured elastic password hash",
        "caused_by" : {
            "type" : "status_exception",
            "reason" : "Cluster state has not been recovered yet, cannot write to the [null] index"
        }
    },
    "status" : 503
}
    </pre>
    <p>The solution was changing the following parameter:</p>
    <pre>cluster.initial_master_nodes: ["localhost.localdomain"]</pre>

    <h2>Kibana</h2>
    <p>I faced issues when trying to connect Kibana to Elasticsearch using a token. The error I received was due to a mismatch between the certificate's alternative names and the server IP. The solution was to manually configure the network host:</p>
    <pre>network.publish_host: 127.0.0.1</pre>

    <h2>Logstash</h2>
    <p>Running Logstash as a service resulted in certificate errors with Elasticsearch. I resolved this by running Logstash from its own <code>bin</code> directory and manually copying configuration files.</p>
    <pre>
mkdir /usr/share/logstash/config
cp /etc/logstash/pipelines.yml /usr/share/logstash/config
cp /etc/logstash/log4j2.properties /usr/share/logstash/config
/usr/share/logstash/bin/logstash
    </pre>

    <footer>&copy; 2024 Your Name</footer>
</body>
</html>
